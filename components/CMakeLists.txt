
list(APPEND CMAKE_MODULE_PATH "${PROJECT_SOURCE_DIR}/components/cmake/recipes")
list(APPEND CMAKE_MODULE_PATH "${PROJECT_SOURCE_DIR}/components/cmake")



set(WMTK_COMPONENT_PREFIX CACHE STRING "wmtk" "Prefix for wmtk")

include(add_component)


#common stuff for all components
add_library("wmtk_utils")
add_library(wmtk::base ALIAS wmtk_base)
add_subdirectory("wmtk_components/base/wmtk/components/base")


#library to link all components libs to
add_library(wildmeshing_components)
add_library(wmtk::components ALIAS wildmeshing_components)
target_include_directories(wildmeshing_components PUBLIC "${CMAKE_CURRENT_SOURCE_DIR}/wmtk_components/main")
target_link_libraries(wildmeshing_components PUBLIC wmtk::toolkit wmtk::base jse::jse)
target_compile_definitions(wildmeshing_components PRIVATE WMTK_APP_INPUT_SPEC="${CMAKE_CURRENT_SOURCE_DIR}/wmtk_spec.json")
add_subdirectory("wmtk_components/main/wmtk/components")


# Group source files for IDEs
file(GLOB_RECURSE COMPONENTS_FILES_FOR_SOURCE_GROUP "${CMAKE_CURRENT_SOURCE_DIR}/wmtk_components/base/*.cpp" "${CMAKE_CURRENT_SOURCE_DIR}/wmtk_components/base/*.hpp")
source_group(TREE "${CMAKE_CURRENT_SOURCE_DIR}/wmtk_components/base/wmtk/components/base" PREFIX "src" FILES ${COMPONENTS_FILES_FOR_SOURCE_GROUP})

SET(WMTK_AUTOGEN_FOLDER "${CMAKE_CURRENT_BINARY_DIR}/autogen")
target_include_directories(wildmeshing_components PRIVATE ${WMTK_AUTOGEN_FOLDER})

#clear autogenerated the files
file(WRITE "${WMTK_AUTOGEN_FOLDER}/components_include.hpp" ${WMTK_AUTOGEN_COMMENT})
file(WRITE "${WMTK_AUTOGEN_FOLDER}/components_map.hpp" ${WMTK_AUTOGEN_COMMENT})
file(WRITE "${WMTK_AUTOGEN_FOLDER}/spec_include.hpp" ${WMTK_AUTOGEN_COMMENT}
"spec_engine.include_directories.push_back( \"${CMAKE_CURRENT_SOURCE_DIR}\");\n"
"spec_engine.include_directories.push_back( \"${WMTK_AUTOGEN_FOLDER}\");\n"
)
set(json_components "")

add_subdirectory(utils)

# list of all components
add_component("input")
add_component("output")
add_component("export_cache")
add_component("import_cache")
add_component("delaunay")
add_component("isotropic_remeshing")
add_component("marching")
add_component("mesh_info")
add_component("multimesh")
add_component("multimesh_from_tag")
add_component("regular_space")
add_component("tag_intersection")
add_component("wildmeshing")
add_component("get_all_meshes")
add_component("procedural")
add_component("fusion")
add_component("triangle_insertion")
add_component("to_points")
add_component("winding_number")
add_component("periodic_optimization")
add_component("shortestedge_collapse")
add_component("tetwild_simplification")

string(LENGTH ${json_components} json_components_length)
math(EXPR json_components_length "${json_components_length}-2")
string(SUBSTRING ${json_components} 0 ${json_components_length} json_components)
file(WRITE "${WMTK_AUTOGEN_FOLDER}/components.json" "[\n${json_components}\n]")



if(WILDMESHING_TOOLKIT_TOPLEVEL_PROJECT)
    add_subdirectory(tests)
    include(jse)
    include(cli11)

endif()






